# HTTP, end2end, Resource, Transaction, Messages

## 프로토콜 이란?

프로토콜을 직역하면 `규약`이다.

일반적으로 프로토콜이라 함은, 통신 프로토콜을 칭하는데 통신(정보를 주고 받음)할 때 객체 간의 `규칙, 양식, 규약` 등을 사전에 정의해놓은 것을 말한다.

> 하드웨어, 소프트웨어, ... 등 모든 것을 총칭하여 객체라고 칭하였습니다.

통신 프로토콜들은 [OSI 7 계층에 곳곳에](https://en.wikipedia.org/wiki/List_of_network_protocols_(OSI_model)) 자리하고 있다.

우리가 자주 보게 되는 프로토콜은 주로 [Application Level의 프로토콜](https://en.wikipedia.org/wiki/List_of_network_protocols_(OSI_model)#Layer_7_(Application_Layer))일 것이다.

Web Client가 URI를 요청할 때 붙는 Scheme`(HTTP, HTTPS, ...)`들이 대표적인 예이다.

결론적으로 두 객체 간의 협의만 이루어 진다면 그 협의 내용이 프로토콜이 되는 것.

이러한 협의 내용은 공식 표준으로 제정된 내용도 있고 `아닌 내용`([Custom Protocol](https://stackoverflow.com/questions/3964152/how-do-i-create-a-custom-protocol-and-map-it-to-an-application))도 있다.

> `Line://`, `Spotify://` 같은 프로토콜도 존재한다.

만약 Client가 Server에게 HTTP Request를 날렸을 때, 표준을 지켜 날린다고 해도 Server가 표준을 지키지 않는다면 기대하는 내용의 Response 를 받을 수 없을 것이다.

## http는 80, https는 443을 기본 포트로 사용한다. URI Scheme과 Port의 상관관계는 무엇일까?

https://gist.github.com/mahmoud/2fe281a8daaff26cfe9c15d2c5bf5c8b

사실 http 스키마을 사용하면서 8080 포트를 사용할 수도 있다.

결국 기본 포트를 뭐로 하느냐는 생략 가능한 포트 번호를 표기하는 것일 뿐 큰 차이는 없지 않을까...?

모르겠다..

## 서버에서 URI를 제공하는 방법(또는 경험)을 말해보자.

URI는 URL과 URN으로 나뉘며 [링크 참고](https://en.wikipedia.org/wiki/Uniform_Resource_Identifier#Examples) 같은 형식을 띄고 있다.

이 중 실질적으로 현재 사용되고 있는 URL(네트워크 상 자원이 어디있는지 알려주기 위한 위치 지시자)에 대해 설명해본다.

1. [URL을 웹 서버의 파일시스템 위치로 대응하기](https://httpd.apache.org/docs/2.4/ko/urlmapping.html)

2. [URL을 규칙 기반으로 동적 redirect 또는 재작성하기](https://httpd.apache.org/docs/2.4/en/rewrite/)

    - [mod_rewrite로 URL 다루기 (ko)](https://www.lesstif.com/pages/viewpage.action?pageId=18219493)

3. 서버 Application에서 URL Routing 기법을 사용하기

    - URL과 대응하는 정적 파일을 반환할 수도 있고
    - URL Query를 DB로 요청하여 특정 데이터를 가져올 수도 있고
    - URL과 대응시켜 동적으로 리소스를 만들어 반환할 수도 있고
    - 등등...

아래는 동적으로 리소스를 만들어 반환하는 스프링 서버입니다.
```java
@Controller
public class HomeController {

	@ResponseBody
	@RequestMapping("/images/random.{ext}")
	byte[] getRandomImage(@PathVariable("ext") String ext) {
		// jpeg : 불투명 랜덤 이미지
		// png : 투명 랜덤 이미지
		// other : not allowed 404
	}

}
```

## URL vs URN, 각 장단점은 무엇일까?

> - 1997 May. ([rfc2141](https://www.ietf.org/rfc/rfc2411.txt))
> - [url vs urn](https://communities.bentley.com/products/projectwise/content_management/f/content-management-forum/158281/url-vs-urn-in-office-links)

### URL

- location 구조를 깊게 만들면 엄청 길어질 수 있다.
- 위치나 구조가 바뀌면 redirect 해주어야만 정상적으로 작동한다.
- location 기반 명세이므로, 클릭하기 전에도 어느 위치로 가는지 알 수 있다.

### URN

- 이름으로만 지시하기 때문에 짧다.
- 위치나 구조에 구애받지 않는다.
- 어느 위치로 가는지 알 수 없다.
